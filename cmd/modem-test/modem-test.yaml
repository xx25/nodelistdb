# Modem Test Configuration
# Example configuration for the modem-test CLI tool

modem:
  device: "/dev/ttyACM0"
  baud_rate: 115200
  dial_prefix: "ATDT"
  hangup_method: "dtr"  # "dtr" (drop DTR) or "escape" (+++ ATH)

  # Timeouts
  dial_timeout: 200s
  carrier_timeout: 5s
  at_command_timeout: 5s
  read_timeout: 1s

  # Init commands - executed in order during modem initialization
  # Customize these for your specific modem
  init_commands:
    - "ATZ"        # Reset modem to profile 0
    - "ATE0"       # Disable local echo
    - "ATV1"       # Verbose result codes (OK, ERROR, CONNECT, etc.)
    - "ATX4"       # Extended result codes (BUSY, NO DIALTONE, etc.)
    - "ATS0=0"     # Disable auto-answer

  # Post-disconnect commands - executed after hangup to get line statistics
  # These vary by modem manufacturer:
  #   USRobotics: AT&V1
  #   ZyXEL:      ATI11
  #   Generic:    AT+MS?
  post_disconnect_commands:
    - "AT&V1"      # Line quality stats (USRobotics modems)
    # - "ATI11"    # Alternative for ZyXEL modems

  # Delay before post-disconnect commands (modem needs time to compute stats)
  # USRobotics and most modems need 1-2 seconds after hangup
  # Based on bforce (2-3s) and qico (2.5s) implementations
  post_disconnect_delay: 2s

  # Stats profile for parsing line statistics output
  # Profiles: "rockwell" (USR/Conexant), "zyxel", "raw" (no parsing)
  stats_profile: rockwell

test:
  count: 10
  inter_delay: 5s
  # phone: "917"           # Single phone number (can be set via CLI -phone flag)
  # phones:                # Multiple phones - called in circular order
  #   - "917"
  #   - "918"
  #   - "919"

  # operators:             # Operator prefixes for routing comparison (optional)
  #   - name: "Direct"     # Friendly name for reports
  #     prefix: ""         # No prefix (direct dial)
  #   - name: "VoIP-A"
  #     prefix: "1#"       # Dial prefix to prepend
  #   - name: "VoIP-B"
  #     prefix: "2#"
  # When operators are configured, each phone is tested with all operators in sequence:
  # Test 1: 917 via Direct → ATDT917
  # Test 2: 917 via VoIP-A → ATDT1#917
  # Test 3: 917 via VoIP-B → ATDT2#917
  # Test 4: 918 via Direct → ATDT918
  # ... and so on

  # csv_file: "modem-test-results.csv"  # Optional: output results to CSV file

emsi:
  our_address: "2:5001/5001"
  system_name: "NodelistDB Tester"
  sysop: "Test"
  location: "Test"
  timeout: 30s
  protocols: []  # Empty = NCP (No Compatible Protocols - test only, no file transfer)
  # protocols: ["ZMO", "ZAP"]  # Example: ZModem protocols for actual file transfer

logging:
  debug: true
  timestamps: true
  show_rs232: true   # Show DCD/DSR/CTS/RI status changes
  show_hex: false    # Show hex dump of TX/RX data (very verbose)

# PostgreSQL results storage (optional)
# postgres_results:
#   enabled: true
#   dsn: "postgres://user:password@localhost:5432/testresults"
#   table_name: "modem_test_results"  # optional, defaults to "modem_test_results"

# MySQL results storage (optional)
# mysql_results:
#   enabled: true
#   dsn: "user:password@tcp(localhost:3306)/testresults?parseTime=true"
#   table_name: "modem_test_results"  # optional, defaults to "modem_test_results"

# AudioCodes CDR configuration (optional) - VoIP quality metrics
# cdr:
#   enabled: true
#   driver: "mysql"      # "postgres" or "mysql" (default: "postgres")
#   dsn: "user:password@tcp(localhost:3306)/voip_db?parseTime=true"  # MySQL DSN
#   # dsn: "postgres://user:password@localhost:5432/voip_db"         # PostgreSQL DSN
#   table_name: "cdr"           # optional, defaults to "cdr"
#   time_window_sec: 120        # time window for matching calls (default: 120)

# Asterisk CDR configuration (optional) - call routing info
# asterisk_cdr:
#   enabled: true
#   driver: "mysql"      # "postgres" or "mysql" (default: "postgres")
#   dsn: "user:password@tcp(localhost:3306)/asterisk?parseTime=true"  # MySQL DSN
#   # dsn: "postgres://user:password@localhost:5432/asterisk"         # PostgreSQL DSN
#   table_name: "cdr"           # optional, defaults to "cdr"
#   time_window_sec: 120        # time window for matching calls (default: 120)
