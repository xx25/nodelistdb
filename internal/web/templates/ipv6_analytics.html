<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPv6 Enabled Nodes - NodelistDB</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="/static/sortable-table.js"></script>
    <style>
        .compact-actions {
            display: flex;
            gap: 0.25rem;
        }

        .compact-actions a {
            padding: 0.125rem 0.25rem;
            font-size: 0.875rem;
        }

        /* Make hostname badges show pointer cursor on hover */
        .badge[title] {
            cursor: help;
            position: relative;
        }

        /* Optional: Add visual feedback when hovering */
        .badge[title]:hover {
            opacity: 0.8;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        /* Red badge for failed services */
        .badge-danger {
            background-color: #dc3545;
            color: white;
            cursor: help;
        }

        .badge-danger:hover {
            background-color: #c82333;
            box-shadow: 0 2px 4px rgba(220, 53, 69, 0.4);
        }

        /* Custom tooltip styling for IPv6 addresses */
        .ipv6-tooltip {
            position: relative;
            cursor: help;
        }

        .ipv6-tooltip:hover::after {
            content: attr(data-ipv6);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: #0f0;
            padding: 8px 12px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
            font-weight: bold;
            white-space: pre;
            z-index: 1000;
            margin-bottom: 5px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            min-width: max-content;
        }

        .ipv6-tooltip:hover::before {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: #333;
            z-index: 1001;
            margin-bottom: -1px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>IPv6 Enabled Nodes</h1>
            <p class="subtitle">Nodes that have been successfully tested with IPv6 connectivity</p>
        </header>

        {{template "nav" .}}

        <div class="content">
            <div class="search-container">
                <form method="get" action="/analytics/ipv6" style="display: flex; gap: 1rem; align-items: center; margin-bottom: 2rem;">
                    <div class="form-group">
                        <label for="days">Period:</label>
                        <select name="days" id="days" class="form-control">
                            <option value="7" {{if eq .Days 7}}selected{{end}}>Last 7 days</option>
                            <option value="30" {{if eq .Days 30}}selected{{end}}>Last 30 days</option>
                            <option value="90" {{if eq .Days 90}}selected{{end}}>Last 90 days</option>
                            <option value="180" {{if eq .Days 180}}selected{{end}}>Last 180 days</option>
                            <option value="365" {{if eq .Days 365}}selected{{end}}>Last year</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="limit">Limit:</label>
                        <select name="limit" id="limit" class="form-control">
                            <option value="50" {{if eq .Limit 50}}selected{{end}}>50</option>
                            <option value="100" {{if eq .Limit 100}}selected{{end}}>100</option>
                            <option value="200" {{if eq .Limit 200}}selected{{end}}>200</option>
                            <option value="500" {{if eq .Limit 500}}selected{{end}}>500</option>
                            <option value="1000" {{if eq .Limit 1000}}selected{{end}}>1000</option>
                        </select>
                    </div>

                    <div class="form-group" style="display: flex; align-items: center; gap: 0.5rem;">
                        <input type="checkbox" name="includeZero" id="includeZero" value="true" {{if .IncludeZeroNodes}}checked{{end}}>
                        <label for="includeZero" style="margin: 0;">Include /0 nodes</label>
                    </div>

                    <button type="submit" class="btn btn-primary">Apply Filters</button>
                </form>
            </div>

            {{if .Error}}
            <div class="alert alert-error">
                <strong>Error:</strong> {{.Error}}
            </div>
            {{end}}

            {{if .IPv6Nodes}}
            <div class="stats-box">
                <h3>Found {{len .IPv6Nodes}} IPv6 Enabled Nodes</h3>
            </div>

            <div class="table-responsive">
                <table class="data-table sortable-table">
                    <thead>
                        <tr>
                            <th data-sortable data-type="address">Node Address</th>
                            <th data-sortable data-type="string">Hostname</th>
                            <th data-sortable data-type="string">Protocols</th>
                            <th data-sortable data-type="string">Location</th>
                            <th data-sortable data-type="date">Last Tested</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{range .IPv6Nodes}}
                        <tr>
                            <td>
                                <a href="/node/{{.Zone}}/{{.Net}}/{{.Node}}" class="node-link">
                                    <strong>{{.Zone}}:{{.Net}}/{{.Node}}</strong>
                                </a>
                            </td>
                            <td>
                                {{if .AllHostnames}}
                                    {{$ipv6List := .ResolvedIPv6}}
                                    {{range $idx, $hostname := .AllHostnames}}
                                        {{if $idx}}<br>{{end}}
                                        <span class="badge badge-info ipv6-tooltip" data-ipv6="{{range $ipIdx, $ip := $ipv6List}}{{if $ipIdx}}&#10;{{end}}{{$ip}}{{end}}">
                                            {{$hostname}}
                                            {{if eq $idx 0}}
                                                <small>(primary)</small>
                                            {{else}}
                                                <small>(backup #{{$idx}})</small>
                                            {{end}}
                                        </span>
                                    {{end}}
                                {{else if .TestedHostname}}
                                    <span class="badge badge-info ipv6-tooltip" data-ipv6="{{range $idx, $ip := .ResolvedIPv6}}{{if $idx}}&#10;{{end}}{{$ip}}{{end}}">
                                        {{.TestedHostname}}
                                        {{if and (gt .TotalHostnames 1) (ge .HostnameIndex 0)}}
                                            {{if eq .HostnameIndex 0}}
                                                <small>(primary)</small>
                                            {{else}}
                                                <small>(backup #{{.HostnameIndex}})</small>
                                            {{end}}
                                        {{end}}
                                    </span>
                                {{else if .Hostname}}
                                    <span class="badge badge-info ipv6-tooltip" data-ipv6="{{range $idx, $ip := .ResolvedIPv6}}{{if $idx}}&#10;{{end}}{{$ip}}{{end}}">{{.Hostname}}</span>
                                {{else}}
                                    <span class="text-muted ipv6-tooltip" data-ipv6="{{if .ResolvedIPv6}}{{range $idx, $ip := .ResolvedIPv6}}{{if $idx}}&#10;{{end}}{{$ip}}{{end}}{{else}}No IPv6{{end}}">N/A</span>
                                {{end}}
                            </td>
                            <td>
                                {{if .BinkPIPv6Tested}}
                                    {{if .BinkPIPv6Success}}
                                        <span class="badge badge-success">BinkP</span>
                                    {{else}}
                                        <span class="badge badge-danger" title="{{.BinkPIPv6Error}}">BinkP</span>
                                    {{end}}
                                {{end}}
                                {{if .IfcicoIPv6Tested}}
                                    {{if .IfcicoIPv6Success}}
                                        <span class="badge badge-success">IFCICO</span>
                                    {{else}}
                                        <span class="badge badge-danger" title="{{.IfcicoIPv6Error}}">IFCICO</span>
                                    {{end}}
                                {{end}}
                                {{if .TelnetIPv6Tested}}
                                    {{if .TelnetIPv6Success}}
                                        <span class="badge badge-success">Telnet</span>
                                    {{else}}
                                        <span class="badge badge-danger" title="{{.TelnetIPv6Error}}">Telnet</span>
                                    {{end}}
                                {{end}}
                                {{if .FTPSuccess}}
                                    <span class="badge badge-success">FTP</span>
                                {{end}}
                            </td>
                            <td>
                                {{if .City}}
                                    {{.City}}, {{.CountryCode}}
                                    {{if .ISP}}
                                        <br><small class="text-muted">{{.ISP}}</small>
                                    {{end}}
                                {{else if .Country}}
                                    {{.Country}}
                                {{else}}
                                    <span class="text-muted">Unknown</span>
                                {{end}}
                            </td>
                            <td data-value="{{.TestTime.Unix}}">
                                <span class="text-muted">{{.TestTime.Format "2006-01-02 15:04"}}</span>
                            </td>
                            <td>
                                <div class="compact-actions">
                                    <a href="/node/{{.Zone}}/{{.Net}}/{{.Node}}" class="btn btn-sm btn-info">View</a>
                                    <a href="/reachability/node?zone={{.Zone}}&net={{.Net}}&node={{.Node}}" class="btn btn-sm btn-secondary">History</a>
                                </div>
                            </td>
                        </tr>
                        {{end}}
                    </tbody>
                </table>
            </div>

            <div class="info-box" style="margin-top: 2rem;">
                <p><strong>Note:</strong> This report shows nodes that have IPv6 addresses resolved and have been successfully tested with at least one protocol over the last {{.Days}} days. All listed nodes have working IPv6 connectivity.</p>
            </div>
            {{else}}
            <div class="alert alert-warning">
                <strong>No IPv6 enabled nodes found for the selected period.</strong><br>
                This could mean that either no nodes with IPv6 addresses were tested during this period, or none of them responded successfully to protocol tests.
            </div>
            {{end}}
        </div>
    </div>

    {{template "footer" .}}
</body>
</html>