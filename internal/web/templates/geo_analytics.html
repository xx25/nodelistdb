{{template "base" .}}

{{define "title"}}Geographic Hosting Distribution{{end}}

{{define "page_title"}}Geographic Hosting Distribution{{end}}

{{define "page_subtitle"}}
<p class="subtitle">Analysis of FidoNet node hosting by country and provider (last {{.Days}} days)</p>
{{if .Updated}}<p class="last-updated">Last Updated: {{.Updated}}</p>{{end}}
{{end}}

{{define "head_scripts"}}
<script src="/static/sortable-table.js"></script>
{{end}}

{{define "content"}}
            {{if .Error}}
            <div class="alert alert-error">
                <strong>Error:</strong> {{.Error}}
            </div>
            {{end}}

            {{if .Distribution}}
            <!-- Summary Statistics -->
            <div class="stats-summary">
                <div class="stat-box">
                    <h3>Total Operational Nodes</h3>
                    <div class="stat-value">{{.Distribution.TotalNodes}}</div>
                </div>
                <div class="stat-box">
                    <h3>Countries</h3>
                    <div class="stat-value">{{len .Distribution.CountryDistribution}}</div>
                </div>
                <div class="stat-box">
                    <h3>Providers</h3>
                    <div class="stat-value">{{len .Distribution.ProviderDistribution}}</div>
                </div>
            </div>

<!-- Top Countries Section -->
<div class="analytics-section">
    <h2>üåç Top Countries by Node Count</h2>
    <div class="table-responsive">
        <table class="data-table sortable-table">
            <thead>
                <tr>
                    <th data-sortable data-type="number">Rank</th>
                    <th data-sortable data-type="string">Country</th>
                    <th data-sortable data-type="string">Code</th>
                    <th data-sortable data-type="number" data-default-sort="desc">Nodes</th>
                    <th data-sortable data-type="number">Percentage</th>
                    <th style="width: 25%;">Distribution</th>
                    <th style="width: 100px;">Actions</th>
                </tr>
            </thead>
                        <tbody>
                {{range $index, $country := .Distribution.TopCountries}}
                <tr>
                    <td>{{add $index 1}}</td>
                    <td><strong>{{countryFlag $country.CountryCode}} {{$country.Country}}</strong></td>
                    <td>{{$country.CountryCode}}</td>
                    <td>{{$country.NodeCount}}</td>
                    <td>{{printf "%.1f" $country.Percentage}}%</td>
                    <td>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: {{$country.Percentage}}%"></div>
                        </div>
                    </td>
                    <td style="white-space: nowrap;">
                        <a href="/analytics/geo-hosting/country?code={{$country.CountryCode}}&days={{$.Days}}" class="btn btn-small" style="font-size: 0.85em; padding: 5px 10px;">View</a>
                    </td>
                </tr>
                {{end}}
            </tbody>
        </table>
    </div>
</div>

<!-- Top Providers Section -->
<div class="analytics-section">
    <h2>üè¢ Top Hosting Providers by Node Count</h2>
    <div class="table-responsive">
        <table class="data-table sortable-table">
            <thead>
                <tr>
                    <th data-sortable data-type="number">Rank</th>
                    <th data-sortable data-type="string">Provider</th>
                    <th data-sortable data-type="string">ASN</th>
                    <th data-sortable data-type="number" data-default-sort="desc">Nodes</th>
                    <th data-sortable data-type="number">Percentage</th>
                    <th>Countries</th>
                    <th style="width: 20%;">Distribution</th>
                    <th style="width: 100px;">Actions</th>
                </tr>
            </thead>
                        <tbody>
                {{range $index, $provider := .Distribution.TopProviders}}
                <tr>
                    <td>{{add $index 1}}</td>
                    <td><strong>{{$provider.Provider}}</strong></td>
                    <td>
                        {{if ne $provider.ASN 0}}
                            AS{{$provider.ASN}}
                        {{else}}
                            -
                        {{end}}
                    </td>
                    <td>{{$provider.NodeCount}}</td>
                    <td>{{printf "%.1f" $provider.Percentage}}%</td>
                    <td>
                        <span class="country-tags">
                            {{range $provider.Countries}}
                                <span class="tag">{{countryFlag .}} {{.}}</span>
                            {{end}}
                        </span>
                    </td>
                    <td>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: {{$provider.Percentage}}%"></div>
                        </div>
                    </td>
                    <td style="white-space: nowrap;">
                        <a href="/analytics/geo-hosting/provider?isp={{$provider.Provider}}&days={{$.Days}}" class="btn btn-small" style="font-size: 0.85em; padding: 5px 10px;">View</a>
                    </td>
                </tr>
                {{end}}
            </tbody>
        </table>
    </div>
</div>

<!-- Time Period Selector -->
<div class="time-selector">
    <p>View different time periods:</p>
    <a href="?days=30" class="btn {{if eq .Days 30}}active{{end}}">Last 30 Days</a>
    <a href="?days=90" class="btn {{if eq .Days 90}}active{{end}}">Last 90 Days</a>
    <a href="?days=365" class="btn {{if eq .Days 365}}active{{end}}">Last Year</a>
    <a href="?days=730" class="btn {{if eq .Days 730}}active{{end}}">Last 2 Years</a>
</div>

<!-- Notes -->
<div class="info-box">
    <h3>‚ÑπÔ∏è About This Report</h3>
    <ul>
        <li>Shows geographic distribution of operational FidoNet nodes (any working server: BinkP, IFCICO, Telnet, FTP, or VModem)</li>
        <li>Geolocation data resolved via external services (ip-api.com, ipinfo.io, ipgeolocation.io)</li>
        <li>Provider information based on ISP/Organization from IP geolocation</li>
        <li>Data updated based on most recent test results per node</li>
    </ul>
</div>
{{else}}
<div class="alert alert-warning">
    <strong>No data available.</strong><br>
    No operational nodes with geolocation data found for the selected period.
</div>
{{end}}
{{end}}
